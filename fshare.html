<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>LAN File Share</title>
  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    :root { --bg:#1e1e1e;--surface:#2a2a2a;--border:#3a3a3a;--text:#e0e0e0;--accent:#6abf9f;--accent-hover:#5aa68a;--success:#87e487;--card-bg:#292929;--spacing:0.75rem;--radius:6px;--progress-height:6px;--chunk-size:16384; }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{background:var(--bg);color:var(--text);font-family:'Segoe UI',sans-serif;display:flex;justify-content:center;padding:calc(var(--spacing)*2);}
    .container{width:100%;max-width:480px;}
    h2{text-align:center;margin-bottom:var(--spacing);font-size:1.6rem;}
    .modes{display:flex;margin-bottom:calc(var(--spacing)*1.5);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .mode{flex:1;padding:var(--spacing);text-align:center;cursor:pointer;background:var(--surface);color:var(--text);font-weight:600;transition:background 0.2s;}
    .mode.active{background:var(--accent);color:#fff;}
    .section{margin-bottom:var(--spacing);}
    label{display:block;margin-bottom:0.25rem;font-size:0.9rem;}
    input[type=text],button{width:100%;padding:0.6rem;margin-bottom:var(--spacing);border:1px solid var(--border);border-radius:var(--radius);background:var(--surface);color:var(--text);font-size:1rem;}
    button{background:var(--accent);border-color:var(--accent);cursor:pointer;font-weight:600;transition:background 0.2s;}
    button:hover:not(:disabled){background:var(--accent-hover);}
    button:disabled{opacity:0.5;cursor:default;}
    .status{text-align:center;color:var(--success);margin-bottom:var(--spacing);font-size:0.95rem;}
    .switch{position:relative;width:60px;height:30px;margin-bottom:var(--spacing);}
    .switch input{opacity:0;width:0;height:0;}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);transition:background 0.2s;}
    .slider:before{position:absolute;content:"";height:22px;width:22px;left:4px;top:4px;background:var(--accent);border-radius:50%;transition:transform 0.2s;}
    input:checked+.slider:before{transform:translateX(30px);}
    .switch-label{display:inline-block;vertical-align:middle;margin-left:var(--spacing);font-size:0.95rem;}
    .box{background:var(--card-bg);border:1px solid var(--border);border-radius:var(--radius);padding:calc(var(--spacing)*1.2);margin-bottom:var(--spacing);}
    .box h3{margin-bottom:var(--spacing);font-size:1rem;text-align:center;}
    .file-card{display:flex;flex-direction:column;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:var(--spacing);margin-bottom:var(--spacing);font-size:0.95rem;}
    .file-info{display:flex;justify-content:space-between;align-items:center;}
    .file-name{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
    .file-status{margin-left:var(--spacing);font-size:0.85rem;color:var(--success);white-space:nowrap;}
    .file-card a{color:var(--accent);text-decoration:none;font-weight:600;margin-left:var(--spacing);}
    .progress-container{width:100%;background:var(--surface);border-radius:var(--radius);overflow:hidden;height:var(--progress-height);margin-top:calc(var(--spacing)/2);}
    .progress-bar{width:0;height:100%;background:var(--accent);transition:width 0.1s;}
    #qrcode{text-align:center;margin-bottom:var(--spacing);}#reader{width:100%;height:200px;margin-bottom:var(--spacing);display:none;}
  </style>
</head>
<body>
  <div class="container">
    <h2>LAN File Share</h2>
    <div class="modes">
      <div id="mode-share" class="mode active">Share</div>
      <div id="mode-receive" class="mode">Receive</div>
    </div>
    <div id="shareSection" class="section">
      <label>Your Share Code</label>
      <input id="my-id" type="text" readonly>
      <div id="qrcode"></div>
    </div>
    <div id="receiveSection" class="section" style="display:none;">
      <label>Enter Share Code</label>
      <input id="connect-id" type="text" placeholder="e.g. abcd-1234">
      <button id="connectBtn">Connect</button>
      <button id="scanBtn">Scan QR Code</button>
      <div id="reader"></div>
    </div>
    <div class="status" id="status">Waiting to connectâ€¦</div>
    <div style="display:flex;align-items:center;margin-bottom:var(--spacing);">
      <div class="switch"><input id="autoDownload" type="checkbox" checked><span class="slider"></span></div>
      <span class="switch-label">Auto Download</span>
    </div>
    <button id="sendBtn" disabled>Select Files to Send</button>
    <input id="fileInput" type="file" multiple hidden>
    <div class="box"><h3>Files Received</h3><div id="receivedArea"></div></div>
    <div class="box"><h3>Files Sent</h3><div id="sentArea"></div></div>
  </div>
  <script>
    const shareTab=document.getElementById('mode-share'),recvTab=document.getElementById('mode-receive'),shareSec=document.getElementById('shareSection'),recvSec=document.getElementById('receiveSection'),scanBtn=document.getElementById('scanBtn'),readerDiv=document.getElementById('reader'),modes=document.querySelector('.modes');let scanner;
    scanBtn.style.display='none';shareTab.onclick=()=>{shareTab.classList.add('active');recvTab.classList.remove('active');shareSec.style.display='';recvSec.style.display='none';scanBtn.style.display='none';readerDiv.style.display='none';};recvTab.onclick=()=>{recvTab.classList.add('active');shareTab.classList.remove('active');shareSec.style.display='none';recvSec.style.display='';scanBtn.style.display='block';};
    const peer=new Peer(),incoming={};;let conn;
    peer.on('open',id=>{document.getElementById('my-id').value=id;QRCode.toCanvas(document.createElement('canvas'),id,{width:150},(e,c)=>{if(!e)document.getElementById('qrcode').appendChild(c);});setStatus('Select mode and connect to begin.');});
    peer.on('connection',c=>{conn=c;onConnect();});document.getElementById('connectBtn').onclick=()=>{const code=document.getElementById('connect-id').value.trim();if(!code)return;conn=peer.connect(code);conn.on('open',onConnect);};
    scanBtn.onclick=()=>{if(!scanner)scanner=new Html5Qrcode('reader');readerDiv.style.display='block';scanner.start({facingMode:'environment'},{fps:10,qrbox:200},code=>{document.getElementById('connect-id').value=code;document.getElementById('connectBtn').click();scanner.stop();readerDiv.style.display='none';}).catch(console.error);};
    function onConnect(){modes.style.display='none';shareSec.style.display='none';recvSec.style.display='none';setStatus('Connected!');document.getElementById('sendBtn').disabled=false;conn.on('data',msg=>{if(msg.type==='file-meta'){incoming[msg.name]={chunks:[],received:0,total:msg.total};createCard('receivedArea',msg.name);}
        else if(msg.type==='file-chunk'){const f=incoming[msg.name];f.chunks[msg.index]=msg.data;f.received++;updateProgress('receivedArea',msg.name,f.received/f.total*100);if(f.received===f.total){const blob=new Blob(f.chunks);const url=URL.createObjectURL(blob);finalizeCard('receivedArea',msg.name,url);}}});}
    document.getElementById('sendBtn').onclick=()=>document.getElementById('fileInput').click();document.getElementById('fileInput').addEventListener('change',e=>{for(const f of e.target.files)sendFile(f);});
    function sendFile(file){const chunkSize=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--chunk-size')),total=Math.ceil(file.size/chunkSize);conn.send({type:'file-meta',name:file.name,total});const reader=new FileReader();let offset=0,index=0;reader.onload=e=>{conn.send({type:'file-chunk',name:file.name,index,total,data:e.target.result});updateProgress('sentArea',file.name,(index+1)/total*100);index++;offset+=chunkSize;if(offset<file.size)readSlice();};const readSlice=()=>{const slice=file.slice(offset,offset+chunkSize);reader.readAsArrayBuffer(slice);};createCard('sentArea',file.name);readSlice();}
    function createCard(areaId,name){const cont=document.getElementById(areaId),card=document.createElement('div');card.className='file-card';card.dataset.filename=name;card.innerHTML=`<div class="file-info"><span class="file-name">${name}</span><span class="file-status">0%</span></div><div class="progress-container"><div class="progress-bar"></div></div>`;cont.appendChild(card);return card;}
    function updateProgress(areaId,name,percent){document.querySelectorAll(`#${areaId} .file-card`).forEach(card=>{if(card.dataset.filename===name){card.querySelector('.progress-bar').style.width=percent+'%';card.querySelector('.file-status').textContent=Math.floor(percent)+'%';}});}
    function finalizeCard(areaId,name,url){document.querySelectorAll(`#${areaId} .file-card`).forEach(card=>{if(card.dataset.filename===name){card.querySelector('.file-status').textContent='Done';const link=document.createElement('a');link.href=url;link.download=name;link.textContent='Download';link.style.marginLeft='var(--spacing)';card.querySelector('.file-info').appendChild(link);if(document.getElementById('autoDownload').checked)link.click();}});}
    function setStatus(msg){document.getElementById('status').textContent=msg;}
  </script>
</body>
</html>
